<?php
namespace Home\Controller;


class BlackController extends CommonController {
    public function _initialize(){
        parent::_initialize(); // TODO: Change the autogenerated stub
    }


    public function index(){

        $where = array();
        $search_value = i('search');
        if(!empty($search_value)){
            $where["d_mobile|d_name|d_address"] = array("like","%".$search_value."%");
        }

        $count = M('dangeruser') ->where($where)->count();
        $p     = new \Think\Page($count,4);
        $page  = $p->show();
        $res  = M('dangeruser') ->where($where)->order('id desc')->limit($p->firstRow.','.$p->listRows)->select();

        foreach ($res as &$v) {
            $v['pic_list'] = array();
            if(!empty($v['pic'])){
                $v['pic_list'] = explode(',',$v['pic']);
            }
            $v['c_date'] = date('Y-m-d H:i:s', $v['c_date']);
            $v['user_name'] =  M('user') -> where(array('id' =>$v['uid'])) -> getField('user_name');;
        }


        $this->assign('info', $res);
        $this->assign('$search', $search_value);
        $this->assign('page', $page);
        $this->display();
	}

}