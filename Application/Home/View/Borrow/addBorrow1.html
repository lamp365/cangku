<extend name="Public/base" />

<block name="css">
    <style>
        .choose_cat{
            margin-top: 20px;
            margin-left: 100px;
            width: 450px;
            text-align: left;
        }
        .choose_cat .title{
            font-weight: bolder;
            font-size: 22px;
            margin-bottom:65px;
        }
    </style>
</block>
<block name="content">
    <div class="choose_cat form-horizonta">
        <p class="title">添加借出</p>
        <div class="form-group">
            <label for="cat_id1" class="col-sm-3 control-label">选择分类1</label>
            <div class="col-sm-9">
                <select name="cat_id1" id="cat_id1" class="form-control">
                    <option value="0">选择一级分类</option>
                    <foreach name="cate" item="onecate">
                        <option value="{$onecate.id}" >{$onecate.cat_name}</option>
                    </foreach>
                </select>
            </div>
        </div>
        <hr class="hr15"/>
        <div class="form-group">
            <label for="cat_id2" class="col-sm-3 control-label">选择分类2</label>
            <div class="col-sm-9">
                <select name="cat_id2" id="cat_id2" class="form-control">
                    <option value="0">选择二级分类</option>
                </select>
            </div>
        </div>
        <hr class="hr15"/>
        <div class="form-group">
            <label for="cat_id2" class="col-sm-3 control-label">所借小组</label>
            <div class="col-sm-9">
                <select name="gid" id="gid" class="form-control">
                    <option value="0">选择从某个小组借出</option>
                    <foreach name="userGroup" item="oneUser">
                        <option value="{$oneUser.id}" >{$oneUser.group_name}</option>
                    </foreach>
                </select>
            </div>
        </div>
        <hr class="hr15"/>
        <div class="form-group">
            <label for="" class="col-sm-3 control-label">&nbsp;</label>
            <div class="col-sm-9">
                <input type="hidden" id="cat_url" value="__CONTROLLER__/getCate">
                <span class="btn btn-info btn-lt" onclick="checkForm()">下一步</span>
            </div>
        </div>
    </div>
</block>

<block name="js">
    <script>
        function checkForm() {
            //检验所选的参数
            var cat_id1 = $("#cat_id1").val();
            var cat_id2 = $("#cat_id2").val();
            var gid = $("#gid").val();
            if(cat_id1 == 0 || cat_id2 == 0 || gid == 0){
                toastr.warning('请选择好分类和小组');
                return ;
            }
            window.location.href='__CONTROLLER__/addBorrow2/cat_id1/'+cat_id1+'/cat_id2/'+cat_id2+'/gid/'+gid;
        }

        $(function () {
            $("#cat_id1").change(function () {
                var cat_id1 = $(this).val();
                if(cat_id1 == 0){
                    var html = '<option value="0">选择二级分类</option>';
                    $("#cat_id2").html(html);
                }else{
                    //异步请求
                    var html = '';
                    var url = "{:U('baohuo/getCate')}";
                    $.post(url,{cat_id1:cat_id1},function(message){
                        if(message.length>0){
                            for(var i=0;i<message.length;i++){
                                var item = message[i];
                                html += '<option value="'+item.id+'">'+item.cat_name+'</option>';
                            }
                        }else{
                            html = '<option value="0">暂无二级分类</option>';

                        }
                        $("#cat_id2").html(html);
                    });
                }
            });
        });
    </script>
</block>
